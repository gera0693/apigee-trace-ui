<mat-toolbar color="primary" class="toolbar">
  <span class="title">Apigee Trace Analyzer</span>
</mat-toolbar>

<div class="page">

  <!-- Upload Card -->
  <mat-card class="upload-card">

    <div class="upload-header">
      <h2>Upload Trace XML</h2>
      <p>Select an Apigee trace file to analyze execution flow and policies.</p>
    </div>

    <div class="upload-area">
      <button mat-raised-button color="primary" (click)="fileInput.click()">
        Select XML File
      </button>

      <input
        #fileInput
        type="file"
        hidden
        accept=".xml"
        (change)="onFileSelected($event)"
      />

      <span *ngIf="loading" class="loading-text">
        Analyzing trace...
      </span>

      <mat-progress-spinner
        *ngIf="loading"
        diameter="40"
        mode="indeterminate">
      </mat-progress-spinner>
    </div>

  </mat-card>

  <!-- Summary Card -->
  <mat-card *ngIf="result" class="summary-card">

    <h3>Trace Summary</h3>

    <div class="summary-grid">
      <div class="summary-item">
        <span class="value">{{ result.summary.totalPolicies }}</span>
        <span class="label">Policies</span>
      </div>

      <div class="summary-item">
        <span class="value">{{ result.summary.totalFaults }}</span>
        <span class="label">Faults</span>
      </div>

      <div class="summary-item">
        <span class="value">{{ result.summary.totalFlows }}</span>
        <span class="label">Flows</span>
      </div>

      <div class="summary-item">
        <span class="value">{{ result.summary.totalTimings }}</span>
        <span class="label">Steps</span>
      </div>
    </div>

  </mat-card>

  <!-- Policies Table -->
  <mat-card *ngIf="result?.policies?.length" class="table-card">

    <h3>Policies Execution</h3>

    <table mat-table [dataSource]="result.policies" class="mat-elevation-z2 full-width">

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let element">{{ element.name }}</td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let element">{{ element.type }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let element">
          <span [ngClass]="{
            'success': element.status === 'Success',
            'error': element.status !== 'Success'
          }">
            {{ element.status }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="executionTime">
        <th mat-header-cell *matHeaderCellDef>Time (ms)</th>
        <td mat-cell *matCellDef="let element">{{ element.executionTime }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>

  </mat-card>

</div>
